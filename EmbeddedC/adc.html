<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ADC - Advanced Computer Engineering</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Advanced Computer Engineering</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="adc"><a class="header" href="#adc">ADC</a></h1>
<p>In this chapter, you will learn how to build a script for reading analog values from the ATmega328P using its ADC (Analog-to-Digital Converter) and output these values to the command line using the USART. This guide will explain the necessary registers and ports related to the ADC.</p>
<blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<ul>
<li>Make sure you have completed the <a href="UART.html">UART Chapter</a> as you will need to print out the data for retrieved from the ADC.</li>
<li>All the information below is synthesised and expanded upon from the <a href="https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdf">Data sheet</a> page 202 onwards.</li>
</ul>
</blockquote>
</blockquote>
<hr />
<h2 id="understanding-adc-registers-and-ports"><a class="header" href="#understanding-adc-registers-and-ports">Understanding ADC Registers and Ports</a></h2>
<p>The ATmega328P has a built-in Analog-to-Digital Converter (ADC) that can convert analog signals to digital values. The ADC uses several registers to configure its operation:</p>
<h3 id="admux-register-overview"><a class="header" href="#admux-register-overview">ADMUX Register Overview</a></h3>
<p>The <strong>ADMUX register</strong> is used to configure the ADC (Analog-to-Digital Converter) on the ATmega328P. It allows you to select:</p>
<ul>
<li>The reference voltage for the ADC.</li>
<li>The input channel from which the ADC reads the analog value.</li>
</ul>
<h3 id="bit-structure-of-admux"><a class="header" href="#bit-structure-of-admux">Bit Structure of ADMUX</a></h3>
<p>The ADMUX register is an 8-bit register, where each bit has a specific purpose:</p>
<div class="table-wrapper"><table><thead><tr><th>Bit 7</th><th>Bit 6</th><th>Bit 5</th><th>Bit 4</th><th>Bit 3</th><th>Bit 2</th><th>Bit 1</th><th>Bit 0</th></tr></thead><tbody>
<tr><td>REFS1</td><td>REFS0</td><td>ADLAR</td><td>MUX3</td><td>MUX2</td><td>MUX1</td><td>MUX0</td><td></td></tr>
</tbody></table>
</div>
<ul>
<li><strong>REFS1, REFS0</strong>: These bits select the reference voltage.</li>
<li><strong>MUX3, MUX2, MUX1, MUX0</strong>: These bits select the ADC input channel</li>
</ul>
<h3 id="admux-adc-multiplexer-selection-register"><a class="header" href="#admux-adc-multiplexer-selection-register"><strong>ADMUX (ADC Multiplexer Selection Register)</strong>:</a></h3>
<ul>
<li>
<p><strong>REFS1:REFS0</strong>: Selects the reference voltage for the ADC. We use AVcc (5V) as the reference in our script.</p>
</li>
<li>
<p><strong>MUX3:MUX0</strong>: Selects the ADC channel to read from. ADC0 is selected when all MUX bits are 0.</p>
<blockquote>
<blockquote>
<p><strong>Note:</strong>
The MUX3:MUX0 bits in the ADMUX register select the ADC input channel:</p>
<div class="table-wrapper"><table><thead><tr><th><strong>MUX3</strong></th><th><strong>MUX2</strong></th><th><strong>MUX1</strong></th><th><strong>MUX0</strong></th><th><strong>Selected ADC Channel</strong></th></tr></thead><tbody>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>ADC0 (PC0)</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>1</td><td>ADC1 (PC1)</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>ADC2 (PC2)</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>1</td><td>ADC3 (PC3)</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>ADC4 (PC4)</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>1</td><td>ADC5 (PC5)</td></tr>
<tr><td>0</td><td>1</td><td>1</td><td>0</td><td>ADC6 (PC6)</td></tr>
<tr><td>0</td><td>1</td><td>1</td><td>1</td><td>ADC7 (PC7)</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>Temperature sensor</td></tr>
<tr><td>1</td><td>1</td><td>0</td><td>0</td><td>1.1V internal reference</td></tr>
<tr><td>1</td><td>1</td><td>0</td><td>1</td><td>GND</td></tr>
</tbody></table>
</div></blockquote>
</blockquote>
</li>
<li>
<p>Use these settings to select the appropriate input channel for your ADC conversions.</p>
</li>
<li>
<p>We also look at the internal temperature sensor too!</p>
</li>
</ul>
<h3 id="example-1-setting-the-reference-voltage-to-avcc"><a class="header" href="#example-1-setting-the-reference-voltage-to-avcc">Example 1: Setting the Reference Voltage to AVcc</a></h3>
<pre><code class="language-c">ADMUX = (1 &lt;&lt; REFS0);
</code></pre>
<ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>(1 &lt;&lt; REFS0)</code> shifts <code>1</code> to the position of the <strong>REFS0</strong> bit (bit 6).</li>
<li>This sets <strong>REFS0</strong> to <code>1</code> and all other bits to <code>0</code>.</li>
</ul>
</li>
<li><strong>Bitwise Result</strong>:
<ul>
<li><code>ADMUX = 0b01000000</code></li>
<li><code>REFS0 = 1</code> (Reference voltage = AVcc)</li>
<li><code>MUX3:MUX0 = 0000</code> (ADC0 channel selected by default)</li>
</ul>
</li>
</ul>
<h3 id="example-2-setting-the-reference-voltage-to-avcc-and-selecting-adc3"><a class="header" href="#example-2-setting-the-reference-voltage-to-avcc-and-selecting-adc3">Example 2: Setting the Reference Voltage to AVcc and Selecting ADC3</a></h3>
<pre><code class="language-c">ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX1) | (1 &lt;&lt; MUX0);
</code></pre>
<ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>(1 &lt;&lt; REFS0)</code>: Sets the <strong>REFS0</strong> bit (bit 6) to <code>1</code> (Reference voltage = AVcc).</li>
<li><code>(1 &lt;&lt; MUX1)</code>: Sets the <strong>MUX1</strong> bit (bit 1) to <code>1</code>.</li>
<li><code>(1 &lt;&lt; MUX0)</code>: Sets the <strong>MUX0</strong> bit (bit 0) to <code>1</code>.</li>
<li>The <code>|</code> operator combines these settings, setting bits <code>REFS0</code>, <code>MUX1</code>, and <code>MUX0</code> to <code>1</code>, while keeping other bits at <code>0</code>.</li>
</ul>
</li>
<li><strong>Bitwise Result</strong>:
<ul>
<li><code>ADMUX = 0b01000011</code></li>
<li><code>REFS0 = 1</code> (Reference voltage = AVcc)</li>
<li><code>MUX3:MUX0 = 0011</code> (ADC3 channel selected)</li>
</ul>
</li>
</ul>
<h3 id="reminder-of-bitwise-operations"><a class="header" href="#reminder-of-bitwise-operations">Reminder of Bitwise operations</a></h3>
<ul>
<li>
<p><code>(1 &lt;&lt; REFS0)</code></p>
<ul>
<li><strong>Operation</strong>: <code>1</code> is shifted left by 6 positions (since REFS0 is bit 6).</li>
<li><strong>Result</strong>: <code>0b01000000</code></li>
</ul>
</li>
<li>
<p><code>(1 &lt;&lt; MUX1)</code></p>
<ul>
<li><strong>Operation</strong>: <code>1</code> is shifted left by 1 position (since MUX1 is bit 1).</li>
<li><strong>Result</strong>: <code>0b00000010</code></li>
</ul>
</li>
<li>
<p><code>(1 &lt;&lt; MUX0)</code></p>
<ul>
<li><strong>Operation</strong>: <code>1</code> is shifted left by 0 positions (since MUX0 is bit 0).</li>
<li><strong>Result</strong>: <code>0b00000001</code></li>
</ul>
</li>
<li>
<p>Combining with the <code>|</code> (or) Operator</p>
<ul>
<li><strong><code>(1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX1) | (1 &lt;&lt; MUX0)</code></strong>:</li>
<li><code>0b01000000 | 0b00000010 | 0b00000001 = 0b01000011</code></li>
</ul>
</li>
</ul>
<hr />
<h3 id="adcsra-adc-control-and-status-register-a"><a class="header" href="#adcsra-adc-control-and-status-register-a"><strong>ADCSRA (ADC Control and Status Register A)</strong>:</a></h3>
<ul>
<li>
<p><strong>ADEN</strong>: ADC Enable. Set this bit to enable the ADC.</p>
</li>
<li>
<p><strong>ADSC</strong>: ADC Start Conversion. Set this bit to start an ADC conversion.</p>
</li>
<li>
<p><strong>ADPS2:ADPS0</strong>: ADC Prescaler Select Bits. These bits determine the division factor between the system clock and the ADC clock. We use a prescaler of 128 for accurate readings.</p>
</li>
<li>
<p><strong>ADC</strong>: This register holds the result of the ADC conversion. It is a 10-bit register divided into two 8-bit registers, ADCL (low byte) and ADCH (high byte).</p>
<blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<p>Prescaler: is a factor by which the system clock is divided to obtain the ADC clock. The ADC clock frequency can be calculated using the formula:
\[ADC_{Clock}\ =\ \frac{Sytem\ Clock}{Prescaler}\]
So \(\therefore \)
\[125kHz\ =\ \frac{16000000}{128}\]</p>
<ul>
<li>125 kHz is within the recommended range of 50 kHz to 200 kHz.</li>
<li>A prescaler of 128 ensures that the ADC operates at an optimal frequency for accurate 10-bit conversions.</li>
<li>Larger the prescaler the longer for conversions, lower frequencies are faster but are less accurate due to errors</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
<hr />
<h2 id="building-a-program-to-grab-the-internal-temperature-of-the-chipset"><a class="header" href="#building-a-program-to-grab-the-internal-temperature-of-the-chipset">Building a program to grab the internal temperature of the chipset</a></h2>
<p>Temperature Sensor and ADC Setup:</p>
<ul>
<li>The internal temperature sensor is connected to a single-ended ADC input.</li>
<li>The MUX[4..0] bits in the ADMUX register should be configured to select the temperature sensor.</li>
<li>The internal 1.1V voltage reference must be used as the ADC reference.</li>
</ul>
<p>The voltage sensitivity is approximately 1LSB/°C and the accuracy of the temperature measurement is ±10°C using
manufacturing calibration values (<code>TS_GAIN</code>, <code>TS_OFFSET</code>)</p>
<p>Typical values for temperautre at set temperatures:</p>
<div class="table-wrapper"><table><thead><tr><th>Temp</th><th>Hex</th><th>Dec</th></tr></thead><tbody>
<tr><td>–40°C</td><td><code>0x010D</code></td><td>\(269_{10}\)</td></tr>
<tr><td>+25°C</td><td><code>0x0160</code></td><td>\(352_{10}\)</td></tr>
<tr><td>+125°C</td><td><code>0x01E0</code></td><td>\(480_{10}\)</td></tr>
</tbody></table>
</div>
<p>We can create a linear relationship between the ADC value and the temperature based on the given typical values. Assuming a linear relationship, we can use the following formula:</p>
<p>\[Temperature(^\circ C)\ =\ (ADC_{value}-Offset) \cdot Scale\ Factor\]</p>
<p>
</p>
<ol>
<li>
<p>Create a new directory called <code>internalADCTemp</code>:</p>
<ul>
<li><code>mkdir ../embeddedc/internalADCTemp &amp;&amp; cd embeddedc/internalADCTemp</code></li>
<li>and navigate to it and then create a file called <code>internalADCTemp.c</code></li>
</ul>
</li>
<li>
<p>Modify the <code>internalADCTemp.c</code> file with the following code:</p>
 <details>
 <summary>Reproduce the code below... [...66 lines]</summary>
<pre><code class="language-c">#include &lt;avr/io.h&gt;
#include &lt;util/delay.h&gt;
#include &lt;stdlib.h&gt; // For itoa()

#define USART_BAUDRATE 9600
#define BAUD_PRESCALER (((16000000UL / (USART_BAUDRATE * 16UL))) - 1)

// Constants based on typical values
#define ADC_AT_25C 352        // ADC value at +25°C (0x0160)
#define TEMPERATURE_SENSITIVITY 1  // 1 LSB/°C

void USART_Init() {
    UBRR0H = (BAUD_PRESCALER &gt;&gt; 8);
    UBRR0L = BAUD_PRESCALER;
    UCSR0C = (1 &lt;&lt; UCSZ01) | (1 &lt;&lt; UCSZ00); // 8 data bits, 1 stop bit, no parity
    UCSR0B = (1 &lt;&lt; RXEN0) | (1 &lt;&lt; TXEN0);   // Enable RX and TX
}

void USART_Transmit(uint8_t data) {
    while (!(UCSR0A &amp; (1 &lt;&lt; UDRE0))); // Wait until the data register is empty
    UDR0 = data;
}

void USART_SendString(char* str) {
    while (*str) {
        USART_Transmit(*str++);
    }
}

void ADC_Init() {
    // Set the reference voltage to internal 1.1V and select the temperature sensor
    ADMUX = (1 &lt;&lt; REFS1) | (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX3);
    // Enable the ADC and set the prescaler to 128
    ADCSRA = (1 &lt;&lt; ADEN) | (1 &lt;&lt; ADPS2) | (1 &lt;&lt; ADPS1) | (1 &lt;&lt; ADPS0);
}

uint16_t ADC_Read() {
    ADCSRA |= (1 &lt;&lt; ADSC); // Start conversion
    while (ADCSRA &amp; (1 &lt;&lt; ADSC)); // Wait for conversion to complete
    return ADC; // Return the ADC value
}

int main() {
    char buffer[10]; // Buffer to store temperature as a string

    USART_Init(); // Initialize USART
    ADC_Init(); // Initialize ADC

    while (1) {
        // Read the ADC value from the temperature sensor
        uint16_t adcValue = ADC_Read();
        
        // Calculate the temperature based on typical values
        // Using a simple linear conversion with 1 LSB/°C sensitivity
        int16_t temperature = adcValue - ADC_AT_25C; // Offset from 25°C
        temperature += 25; // Adjust to get the temperature in °C

        // Convert temperature to string and send it via USART
        itoa(temperature, buffer, 10); // Convert temperature to string (base 10)
        USART_SendString("Temperature: ");
        USART_SendString(buffer);
        USART_SendString(" C\n");
        _delay_ms(1000); // Delay for demonstration
    }
}
</code></pre>
 </details>
</li>
<li>
<p>Once you have saved the script, you can now make the <code>Makefile</code></p>
 <details>
 <summary>Code here...[27 lines]</summary>
<pre><code class="language-Makefile">MCU = atmega328p
F_CPU = 16000000UL
CC = avr-gcc
CFLAGS = -Os -mmcu=$(MCU) -DF_CPU=$(F_CPU)
OBJCOPY = avr-objcopy
AVRDUDE = avrdude
AVRDUDECONFIG="C:\ProgramData\arduino-ide-v2\Local\Arduino15\packages\arduino\tools\avrdude\6.3.0-arduino17\etc\avrdude.conf"
PORT = COM6
BAUD = 115200
PROGRAMMER = -c arduino -p $(MCU) -P $(PORT) -b $(BAUD)

all: internalADCTemp.hex

internalADCTemp.hex: internalADCTemp.elf
        $(OBJCOPY) -O ihex -R .eeprom $&lt; $@

internalADCTemp.elf: internalADCTemp.o
        $(CC) $(CFLAGS) -o $@ $&lt;

internalADCTemp.o: internalADCTemp.c
        $(CC) $(CFLAGS) -c -o $@ $&lt;

upload: internalADCTemp.hex
        $(AVRDUDE) -C $(AVRDUDECONFIG) $(PROGRAMMER) -U flash:w:internalADCTemp.hex

clean:
        rm -f internalADCTemp.o internalADCTemp.elf internalADCTemp.hex
</code></pre>
<blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<ul>
<li>remember to check for the correct port number
<img src="./figures/windows_com_ports_list.png" alt="" /></li>
</ul>
</blockquote>
</blockquote>
 </details>
</li>
<li>
<p>You can now compile and upload and use putty like you did in ADC,</p>
<ul>
<li>
<p><code>make</code></p>
</li>
<li>
<p><code>make upload</code></p>
<p><img src="./figures/internal_adc_temp.png" alt="" /></p>
</li>
</ul>
</li>
</ol>
<hr />
<h2 id="so-how-to-access-the-a0-5-pins"><a class="header" href="#so-how-to-access-the-a0-5-pins">So how to access the A0-5 pins</a></h2>
<p>Now, let's write the script step by step:</p>
<ul>
<li>
<p><strong>Initialize the ADC</strong>:</p>
<ul>
<li>Configure the reference voltage and select the ADC channel using the ADMUX register.</li>
<li>Enable the ADC and set the prescaler using the ADCSRA register.</li>
</ul>
</li>
<li>
<p><strong>Read from the ADC</strong>:</p>
<ul>
<li>Start the ADC conversion.</li>
<li>Wait for the conversion to complete and read the ADC value.</li>
</ul>
</li>
<li>
<p><strong>Send the ADC Value via USART</strong>:</p>
<ul>
<li>Convert the ADC value to a string.</li>
<li>Send the string over serial communication.</li>
</ul>
</li>
</ul>
<ol>
<li>
<p>Create a new directory called <code>adcread</code>:</p>
<ul>
<li><code>mkdir ../embeddedc/adcread &amp;&amp; cd embeddedc/adcread</code></li>
<li>and navigate to it and then create a file called <code>adcread.c</code></li>
</ul>
</li>
<li>
<p>Modify the <code>adcread.c</code> file with the following code:</p>
 <details>
 <summary>Code here... [52 lines]</summary>
<pre><code class="language-c">#include &lt;avr/io.h&gt;
#include &lt;util/delay.h&gt;
#include &lt;stdlib.h&gt; // For itoa()

#define USART_BAUDRATE 9600
#define BAUD_PRESCALER (((16000000UL / (USART_BAUDRATE * 16UL))) - 1)

void USART_Init() {
    UBRR0H = (BAUD_PRESCALER &gt;&gt; 8);
    UBRR0L = BAUD_PRESCALER;
    UCSR0C = (1 &lt;&lt; UCSZ01) | (1 &lt;&lt; UCSZ00); // 8 data bits, 1 stop bit, no parity
    UCSR0B = (1 &lt;&lt; RXEN0) | (1 &lt;&lt; TXEN0);   // Enable RX and TX
}

void USART_Transmit(uint8_t data) {
    while (!(UCSR0A &amp; (1 &lt;&lt; UDRE0))); // Wait until the data register is empty
    UDR0 = data;
}

void USART_SendString(char* str) {
    while (*str) {
        USART_Transmit(*str++);
    }
}

void ADC_Init() {
    ADMUX = (1 &lt;&lt; REFS0); // Reference voltage = AVcc, ADC0 channel selected
    ADCSRA = (1 &lt;&lt; ADEN) | (1 &lt;&lt; ADPS2) | (1 &lt;&lt; ADPS1) | (1 &lt;&lt; ADPS0); // Enable ADC, prescaler = 128
}

uint16_t ADC_Read() {
    ADCSRA |= (1 &lt;&lt; ADSC); // Start conversion
    while (ADCSRA &amp; (1 &lt;&lt; ADSC)); // Wait for conversion to complete
    return ADC;
}

int main() {
    char buffer[10]; // Buffer to store ADC value as a string

    USART_Init(); // Initialize USART
    ADC_Init(); // Initialize ADC

    while (1) {
        uint16_t adcValue = ADC_Read(); // Read ADC value
        itoa(adcValue, buffer, 10); // Convert ADC value to string (base 10)
        USART_SendString("ADC Value: ");
        USART_SendString(buffer);
        USART_SendString("\n");
        _delay_ms(1000); // Delay for demonstration
    }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<ul>
<li><code>A0</code> : <code>ADMUX = (1 &lt;&lt; REFS0);</code></li>
<li><code>A1</code> : <code>ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX0);</code></li>
<li><code>A2</code> : <code>ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX1);</code></li>
<li><code>A3</code> : <code>ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX1) | (1 &lt;&lt; MUX0);</code></li>
<li><code>A4</code> : <code>ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX2);</code></li>
<li><code>A5</code> : <code>ADMUX = (1 &lt;&lt; REFS0) | (1 &lt;&lt; MUX2) | (1 &lt;&lt; MUX0);</code></li>
</ul>
</blockquote>
</blockquote>
</li>
<li>
<p>Copy the <code>Makefile</code> from <code>../internalADCTemp/Makefile</code> to <code>readadc/</code> and use the regex <code>:%s/\&lt;internalADCTemp\&gt;/adcread/g</code></p>
</li>
<li>
<p>Compile, upload to the board and monitor with putty</p>
<ul>
<li><code>make</code></li>
<li><code>make upload</code></li>
</ul>
<p><img src="./figures/adcread.png" alt="" /></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../EmbeddedC/UART.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Redirection/Redirection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../EmbeddedC/UART.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Redirection/Redirection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
