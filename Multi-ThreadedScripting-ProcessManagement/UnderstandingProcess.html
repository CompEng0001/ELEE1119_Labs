<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Multi-Threading 2 - Advanced Computer Engineering</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="spacer"></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Main</li><li class="chapter-item "><a href="../Introduction/Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item "><a href="../Debian_Rock/Debian_Rock.html"><strong aria-hidden="true">2.</strong> Debian Rock C4</a></li><li class="chapter-item "><a href="../SystemsStats/SystemsStats.html"><strong aria-hidden="true">3.</strong> Systems Stats Script</a></li><li class="chapter-item "><a href="../tmux/tmux.html"><strong aria-hidden="true">4.</strong> Terminal Multiplexing</a></li><li class="chapter-item "><a href="../Learning_C/Learning_C.html"><strong aria-hidden="true">5.</strong> Learning C</a></li><li class="chapter-item "><a href="../Programming_Computers/programming_computers.html"><strong aria-hidden="true">6.</strong> Programming Computers</a></li><li class="chapter-item "><a href="../Multi-ThreadedScripting-ProcessManagement/Multi-ThreadedScripting-ProcessManagement.html"><strong aria-hidden="true">7.</strong> Multi-Threading 1</a></li><li class="chapter-item expanded "><a href="../Multi-ThreadedScripting-ProcessManagement/UnderstandingProcess.html" class="active"><strong aria-hidden="true">8.</strong> Multi-Threading 2</a></li><li class="chapter-item "><a href="../SystemCalls/SystemCalls.html"><strong aria-hidden="true">9.</strong> System Calls</a></li><li class="chapter-item "><a href="../Bash/Bash_Scripting.html"><strong aria-hidden="true">10.</strong> Bash</a></li><li class="chapter-item "><a href="../RFC_Logger/rfclogger.html"><strong aria-hidden="true">11.</strong> RFC Logger</a></li><li class="chapter-item "><a href="../ManPages/ManPages.html"><strong aria-hidden="true">12.</strong> Man Pages</a></li><li class="chapter-item "><div><strong aria-hidden="true">13.</strong> Daemons</div></li><li class="chapter-item "><div><strong aria-hidden="true">14.</strong> Nixos Package Manager</div></li><li class="chapter-item "><div><strong aria-hidden="true">15.</strong> Redirection</div></li><li class="chapter-item "><div><strong aria-hidden="true">16.</strong> Shell Commands</div></li><li class="chapter-item "><div><strong aria-hidden="true">17.</strong> UUID</div></li><li class="chapter-item "><div><strong aria-hidden="true">18.</strong> RFC Logger</div></li><li class="spacer"></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Bourne Again SHell</li><li class="chapter-item "><div><strong aria-hidden="true">19.</strong> Shell</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">19.1.</strong> Installation</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.2.</strong> Introducing the Shell</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.3.</strong> Navigating File and Directories</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.4.</strong> Working with FIles and Directories</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.5.</strong> Pipes and Filters</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.6.</strong> Loop</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.7.</strong> Scripts</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.8.</strong> Finding Things</div></li><li class="chapter-item "><div><strong aria-hidden="true">19.9.</strong> Summary of Basic Commands</div></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">20.</strong> Extra Shell</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">20.1.</strong> Manual Pages</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.2.</strong> Working Remotely</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.3.</strong> Permissions</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.4.</strong> Working with Files and Directories</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.5.</strong> Job Control</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.6.</strong> Aliases and bash customisation</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.7.</strong> Shell Variables</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.8.</strong> Summary of Commands</div></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">21.</strong> Shell Style Guide</div></li><li class="chapter-item "><div><strong aria-hidden="true">22.</strong> System Statistics Script</div></li><li class="chapter-item "><div><strong aria-hidden="true">23.</strong> RFC Logger Script</div></li><li class="chapter-item "><div><strong aria-hidden="true">24.</strong> Man page Example</div></li><li class="spacer"></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Git</li><li class="chapter-item "><a href="../myFirstRepository/myFirstRepository.html"><strong aria-hidden="true">25.</strong> My First Repository</a></li><li class="chapter-item "><a href="../BranchingModel/BranchingModel.html"><strong aria-hidden="true">26.</strong> Branching-Strategy</a></li><li class="chapter-item "><a href="../OneFlow/OneFlow.html"><strong aria-hidden="true">27.</strong> Git Oneflow</a></li><li class="chapter-item "><a href="../AntiPatterns/AntiPatterns.html"><strong aria-hidden="true">28.</strong> Anti Patterns</a></li><li class="chapter-item "><a href="../ContinousDeployment/ContinousDeployment.html"><strong aria-hidden="true">29.</strong> Continous Deployment</a></li><li class="chapter-item "><a href="../ReleaseDeployment/ReleaseDeployment.html"><strong aria-hidden="true">30.</strong> Release Deployment</a></li><li class="chapter-item "><a href="../Migration/Migration.html"><strong aria-hidden="true">31.</strong> Migration</a></li><li class="spacer"></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Operating Systems/ Virtual Machines</li><li class="chapter-item "><a href="../VSphere/Introduction.html"><strong aria-hidden="true">32.</strong> VSphere</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">32.1.</strong> CentOS</div></li><li class="chapter-item "><div><strong aria-hidden="true">32.2.</strong> NixOS</div></li><li class="chapter-item "><div><strong aria-hidden="true">32.3.</strong> Arch</div></li><li class="chapter-item "><div><strong aria-hidden="true">32.4.</strong> Raspberry Pi OS</div></li><li class="chapter-item "><div><strong aria-hidden="true">32.5.</strong> Windows Core IoT</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Advanced Computer Engineering</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>As a system administrator, you will probably interact with <strong>processes</strong> in many different ways.</p>
<p>Sometimes, you may want to run commands in order to <strong>identify processes that are consuming a lot of resources</strong> on your host.</p>
<p>You may have receive a call from a user stating that one of their processes got stucked and that you may need to kill it in order to keep on working.</p>
<p>Processes are really at the center of the Linux operating system : created by the Kernel itself, <strong>they represent running operations currently happening on your Linux host</strong>.</p>
<p>Processes are everywhere, they may run in the <strong>background</strong> or you may choose to initialize them by yourself for custom operations.</p>
<p>You may choose to <strong>start</strong> them, to <strong>interrupt</strong> them, to <strong>resume</strong> them or to <strong>stop</strong> them.</p>
<p>In this tutorial, we are taking a very close look at processes, what they are, and how they are used on our operating system.</p>
<p>We will discover all the commands associated with processes, what signals are and how we can assign more computational resources to our existing processes.</p>
<p>Here we go...</p>
<p><strong>Learning outcomes</strong></p>
<ul>
<li>What <strong>processes</strong> are and how they are <strong>created</strong> on a Linux system</li>
<li>How processes can be <strong>identified</strong> on a Linux system</li>
<li>What <strong>background</strong> and <strong>foreground</strong> processes are</li>
<li>What <strong>signals</strong> are and how they can be used to interact with processes</li>
<li>How to use the <code>pgrep</code> as well as the <code>pkill</code> command effectively</li>
<li>How to adjust process priority using <code>nice</code> and <code>renice</code></li>
<li>How to see <strong>process activity in real-time</strong> on Linux</li>
</ul>
<hr />
<h2 id="linux-processes-basics"><a class="header" href="#linux-processes-basics">Linux Processes Basics</a></h2>
<p>In short, <strong>processes are running programs on your Linux host</strong> that perform operations such as writing to a disk, writing to a file, or running a web server for example.</p>
<p>Process have a <strong>owner</strong> and they are identified by a <strong>process ID</strong> (also called <strong>PID</strong>)</p>
<div align="center">
<p><img src="figures/processIdentity.png" alt="" /></p>
</div>
<p>On the other hand, <strong>programs</strong> are lines or code or lines of machine instructions stored on a persistent data storage.</p>
<p>They can just sit on your data storage, or they can be in execution, i.e running as processes.</p>
<h2 id="difference-program--proces"><a class="header" href="#difference-program--proces">Difference Program &amp; Proces</a></h2>
<div align="center">
<p><img src="figures/programVsProcess.png" alt="" /></p>
</div>
<p>In order to perform the operations they are assigned to, processes need <strong>resources</strong> : <strong>CPU time</strong>, <strong>memory</strong> (such as <strong>RAM</strong> or <strong>disk</strong> <strong>space</strong>), but also virtual memory such as <strong>swap</strong> <strong>space</strong> in case your process gets too greedy.</p>
<p>Obviously, processes can be <strong>started</strong>, <strong>stopped</strong>, <strong>interrupted</strong> and even <strong>killed</strong>.</p>
<p>Before issuing any commands, let’s see how processes are created and managed by the kernel itself.</p>
<hr />
<h2 id="process-initialization-on-linux"><a class="header" href="#process-initialization-on-linux">Process Initialization on Linux</a></h2>
<p>As we already stated, processes are managed by th<strong>e Kernel</strong> on Linux.</p>
<p>However, there is a core concept that you need to understand in order to know how Linux creates processes.</p>
<p>By default, when you boot a Linux system, your Linux kernel is loaded into memory, it is given a virtual filesystem in the RAM (also called <strong>initramfs</strong>) and the initial commands are executed.</p>
<p>One of those commands starts <strong>the very first process on Linux</strong>.</p>
<p>Historically, this process was called the init process but it got replaced by the systemd initialization process on many recent Linux distributions.</p>
<p>To prove it, run the following command on your terminal:</p>
<pre><code class="language-sh">$ ps -aux | head -n 2
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<blockquote>
<p>Your mileage may very, you will have different metrics but the structure will be the same.</p>
</blockquote>
</blockquote>
<div align="center">
<p><img src="figures/ps-aux.png" alt="" /></p>
</div>
<p>As you can see, the <code>systemd</code> process has a <strong>PID of 1</strong>.</p>
<p>If you were to print all processes on your system, using a tree display, you would find that all processes are children of the <code>systemd</code> one.</p>
<pre><code class="language-sh">$ pstree
</code></pre>
<div align="center">
<p><img src="figures/pstree.png" alt="" /></p>
</div>
<p>It is noteworthy to underline the fact that all those initialization steps (except for the launch of the initial process) are done in a reserved space called <strong>the kernel space</strong>.</p>
<p>The kernel <strong>space is a space reserved to the Kernel</strong> in order for it to run essential system tools properly and to make sure that your entire host is running in a consistent way.</p>
<p>On the other hand, <strong>user space is reserved for processes</strong> launched by the user and managed by the kernel itself.</p>
<hr />
<h2 id="user--kernel-space"><a class="header" href="#user--kernel-space">User &amp; Kernel Space</a></h2>
<div align="center">
<p><img src="figures/kernel-user-space.png" alt="" /></p>
</div>
<p>As a consequence, the systemd process is the very first process launched in the user space.</p>
<h2 id="process-creation-using-fork-and-exec"><a class="header" href="#process-creation-using-fork-and-exec">Process Creation using <code>fork</code> and <code>exec</code></a></h2>
<p>When you are creating and running a program on Linux, it generally involves two main steps : <strong>fork</strong> and <strong>execute</strong>.</p>
<h3 id="fork-operation"><a class="header" href="#fork-operation">Fork operation</a></h3>
<p>Fork is a clone operation, it takes the current process, also called the parent process, and it clones it in a new process with a brand new process ID.</p>
<p>When forking, everything is copied from the parent process : the <strong>stack</strong>, the <strong>heap</strong>, but also the file descriptors meaning <strong>the standard input, the standard output and the standard error</strong>.</p>
<p>It means that if my parent process was writing to the current shell console, the child process will also write to the shell console.</p>
<p><strong>Fork Operation</strong></p>
<div align="center">
<p><img src="figures/fork-operation.png" alt="" /></p>
</div>
<p>The execution of the cloned process will also start <strong>at the same instruction as the parent process</strong>.</p>
<h3 id="execute-operation"><a class="header" href="#execute-operation">Execute Operation</a></h3>
<p>The execute operation is used on Linux <strong>to replace the current process image with the image from another process</strong>.</p>
<p>On the previous diagram, we saw that the stack of the parent process contained three instructions left.</p>
<p>As a consequence, the instructions were copied to the new process but they are not relevant to what we want to execute.</p>
<p>The exec operation will replace the process image (i.e the set of instructions that need to be executed) by another one.</p>
<p><strong>Exec Operation</strong></p>
<div align="center">
<p><img src="figures/exec-operation.png" alt="" /></p>
</div>
<p>If you were for example to execute the exec command in your bash terminal, your shell would terminate as soon as the command is completed as your current process image (your bash interpreter) would be replaced with the context of the command you are trying to launch.</p>
<p>For example run:</p>
<pre><code class="language-sh">$ exec ls -l
</code></pre>
<p>Time to open a new terminal :P</p>
<p>If you were to trace the system calls done when creating a process, you would find that the first <code>C</code> command called is the <code>exec</code> one.</p>
<p>Try the following: </p>
<pre><code class="language-sh">$ strace ls -l
</code></pre>
<div align="center">
<p><img src="figures/strace-ls.png" alt="" /></p>
</div>
<hr />
<h2 id="creating-processes-from-a-shell-environment"><a class="header" href="#creating-processes-from-a-shell-environment">Creating processes from a shell environment</a></h2>
<p>When you are launching a shell console, the exact same principles apply when you are launching a command.</p>
<p>A shell console is a process that waits for input from the user.</p>
<p>It also launches a bash interpreter when you hit Enter and it provides an environment for your commands to run.</p>
<p>But the shell follows the steps we described earlier.</p>
<p>When you hit enter, t<strong>he shell is forked to a child process</strong> that will be responsible for running your command. The shell will wait patiently until the execution of the child process finishes.</p>
<p>On the other hand, t<strong>he child process is linked to the same file descriptors</strong> and it may share variables that were declared on a global scope.</p>
<p>The child process executes the “<code>exec</code>” command in order to replace the current process image (which is the shell process image) in the process image of the command you are trying to run.</p>
<p>The child process will eventually finish and it will print its result to the standard output it inherited from the parent process, in this case the shell console itself.</p>
<h3 id="shell-command-execution"><a class="header" href="#shell-command-execution">Shell Command Execution</a></h3>
<div align="center">
<p><img src="figures/shell-command-execute.png" alt="" /></p>
</div>
<p>Now that you have some basics about how processes are created in your Linux environment, let’s see some details about processes and how they can be identified easily.</p>
<hr />
<h2 id="identifying-running-processes-on-linux"><a class="header" href="#identifying-running-processes-on-linux">Identifying running processes on Linux</a></h2>
<p>The easiest way to identify running processes on Linux is to run the <code>ps</code> command.</p>
<div align="center">
<p><img src="figures/ps.png" alt="" /></p>
</div>
<p>By default, the <code>ps</code> command will show you the list of the current running processes owned by the current user.</p>
<p>In this case, only two processes are running for my user : the <code>bash</code> called <code>zsh</code> interpreter and the <code>ps</code> command I have run into it.</p>
<blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<p>Your <code>bash</code> interperter will be <code>bash</code>, unless you changed it.</p>
</blockquote>
</blockquote>
<p>The important part here is that processes have <strong>owners</strong>, most of the time the user who run them in the first place.</p>
<p>To illustrate this, let’s have a listing of the first ten processes on your Linux operating system, with a different display format.</p>
<p>Try the following:</p>
<pre><code class="language-sh">$ ps -ef | head -n 10
</code></pre>
<div align="center">
<p><img src="figures/ps-ef.png" alt="" /></p>
</div>
<p>As you can see here, the top ten processes are owned by the user “<code>root</code>&quot;.</p>
<p>This information will be particularly important when it comes to interacting with processes with signals.</p>
<p>To display the processes that are owned and executed by the current connected user, run the following command:</p>
<pre><code class="language-sh">$ ps u
</code></pre>
<div align="center">
<p><img src="figures/ps-u.png" alt="" /></p>
</div>
<p>There are plenty of different options for the <code>ps</code> command, and they can be seen by running the manual command, remember <code>man</code>:</p>
<pre><code class="language-sh">$ man ps
</code></pre>
<p>From experience, the two most important commands in order to see running processes are:</p>
<pre><code class="language-sh">$ ps aux
</code></pre>
<div align="center">
<p><img src="figures/ps-aux-head.png" alt="" /></p>
</div>
<p>That corresponds to a <strong>BSD-style process listing</strong>, where the following command:</p>
<pre><code class="language-sh">$ ps -ef

UID  PID  PPID C STIME TTY  TIME CMD
</code></pre>
<p>Corresponds to a <strong>POSIX-style process listing</strong>.</p>
<p>They are both representing current running processes on a system, but the first one has the “<code>u</code>” option for “user oriented” which makes it easier to read process metrics.</p>
<div align="center">
<p><img src="figures/ps-aux-2.png" alt="" /></p>
</div>
<p>Now that you have seen what processes are and how they can be listed, let’s see what background and foreground processes are on your host.</p>
<hr />
<h2 id="background-and-foreground-processes"><a class="header" href="#background-and-foreground-processes">Background and foreground processes</a></h2>
<p>The definition of background and foreground processes are pretty self-explanatory.</p>
<h3 id="jobs-and-processes-in-the-current-shell"><a class="header" href="#jobs-and-processes-in-the-current-shell">Jobs and processes in the current shell</a></h3>
<p><strong>A background process on Linux is a process that runs in the background, meaning that it is not actively managed by a user through a shell for example.</strong></p>
<p>On the opposite side, <strong>a foreground process is a process that can be interacted with via direct user input</strong>.</p>
<p>Let’s say for example that you have opened a shell terminal, and that you typed the following command in your console.</p>
<pre><code class="language-sh">$ sleep 10000
</code></pre>
<p>As you probably noticed, your terminal will hang until the termination of the sleep process. As a consequence, the process is not executed in the background, it is executed in the foreground.</p>
<p>I am able to interact with it. If I press <strong>Ctrl</strong> + <strong>Z</strong>, it will directly send a stop signal to the process for example.</p>
<div align="center">
<p><img src="./figures/sleep-Z.png" alt="" /></p>
</div>
<p>However, there is a way to execute the process in the background.</p>
<p>To execute a process in the background, simply put a “<code>&amp;</code>” sign at the end of your command. You might remember doing this when we launched <code>konsole</code> in <code>Xfce Terminal</code> with the <code>&amp;</code>.</p>
<pre><code class="language-sh">$ sleep 10000 &amp;
</code></pre>
<p>As you can see, the control was directly given back to the user and the process started executing in the background.</p>
<div align="center">
<p><img src="./figures/sleep-bg.png" alt="" /></p>
</div>
<p>To see your process running, in the context of the current shell, you can execute the jobs command</p>
<pre><code class="language-sh">$ jobs
</code></pre>
<div align="center">
<p><img src="./figures/jobs.png" alt="" /></p>
</div>
<p>Jobs are a list of processes that were started in the context of the current shell and that may still be running in the background.</p>
<p>As you can see in the example above, I have two processes currently running in the background.</p>
<p>The different columns from left to right represent the the <strong>job ID</strong>, the <strong>process state</strong> (that you will discover in the next section), and the <strong>command executed</strong>.</p>
<h3 id="using-bg-and-fg-commands"><a class="header" href="#using-bg-and-fg-commands">Using <code>bg</code> and <code>fg</code> commands</a></h3>
<p>In order to interact with jobs, you have two commands available : <code>bg</code> and <code>fg</code>.</p>
<p>The bg command is used on Linux in order to send a process to the background and the syntax is as follows</p>
<pre><code class="language-sh">$ bg %&lt;job_id&gt;
</code></pre>
<p>Similarly, in order to send a process to the foreground, you can use the fg in the same fashion</p>
<pre><code class="language-sh">$ fg %&lt;job_id&gt;
</code></pre>
<p>If we go back to the list of jobs of our previous example, if I want to bring the job 3 to the foreground, meaning to the current shell window, I would execute the following command</p>
<pre><code class="language-sh">$ fg $2
</code></pre>
<div align="center">
<p><img src="./figures/fg-2.png" alt="" /></p>
</div>
<p>By issuing a <strong>Ctrl</strong> + <strong>Z</strong> command, I am able to stop the process. I can link it with a bg command in order to send it to the background.</p>
<p>Now that you have a better idea of what background and foreground processes are, let’s see how it is possible for you to interact with process using signals.</p>
<hr />
<h2 id="interacting-with-processess-using-signals"><a class="header" href="#interacting-with-processess-using-signals">Interacting with processess using Signals</a></h2>
<p>On Linux, signals are a form of <strong>interprocess communication</strong> (also called <strong>IPC</strong>) that creates and sends asynchronous notifications to running processes about the occurrence of a specific event.</p>
<p>Signals are often used in order to <strong>send a kill</strong> or a termination command to a <strong>process</strong> in order to shut it down (also called <strong>kill signal</strong>).</p>
<p>In order to send a signal to a process, you have to use the <code>kill</code> or <code>pkill</code> command.</p>
<pre><code class="language-sh">$ kill -&lt;signal number&gt; &lt;pid&gt; 
$ kill -&lt;signal number&gt; &lt;process_name&gt;
$ pkill -&lt;signal number&gt; &lt;process_name&gt;
</code></pre>
<p>For example, in order to force a HTTPD process (PID = 123) to terminate (without a clean shutdown), you would run the following command:</p>
<pre><code class="language-sh">$ kill -9 123
$ pkill -9 HTTPD
</code></pre>
<p>As explained, there are many signals that one can send in order to notify a specific process.</p>
<p>Here is the list of the most common used ones :</p>
<ul>
<li>
<p><strong>SIGINT</strong> : short for signal interrupt is a signal used in order to interrupt a running process. It is also the signal that is being sent when a user pressed <strong>Ctrl</strong> + <strong>C</strong> on a terminal;</p>
</li>
<li>
<p><strong>SIGHUP</strong> : short for signal hangup is the signal sent by your terminal when it is closed. Similarly to a <strong>SIGINT</strong>, the process terminates;</p>
</li>
<li>
<p><strong>SIGKILL</strong> : signal used in order to force a process to stop whether it can be gracefully stopped or not. This signal can not be ignored except for the init process (or the systemd one on recent distributions);</p>
</li>
<li>
<p><strong>SIGQUIT</strong> : specific signal sent when a user wants to quit or to exit the current process. It can be invoked by pressing <strong>Ctrl</strong> + <strong>D</strong> and it is often used in terminal shells or in SSH sessions;</p>
</li>
<li>
<p><strong>SIGUSR1</strong>, SIGUSR2 : those signals are used purely for communication purposes and they can be used in programs in order to implement custom handlers;</p>
</li>
<li>
<p><strong>SIGSTOP</strong> : instructs the process to stop its execution without terminating the process. The process is then waiting to be continued or to be killed completely;</p>
</li>
<li>
<p><strong>SIGCONT</strong> : if the process is marked as stopped, it instructs the process to start its execution again.
In order to see the full list of all signals available, you can run the following command</p>
</li>
</ul>
<pre><code class="language-sh">$ kill -l

 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL
 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE
 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2
13) SIGPIPE     14) SIGALRM     15) SIGTERM     16) SIGSTKFLT
17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU
25) SIGXFSZ     26) SIGVTALRM   27) SIGPROF     28) SIGWINCH
29) SIGIO       30) SIGPWR      31) SIGSYS      34) SIGRTMIN
35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4
39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12
47) SIGRTMIN+13 48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14
51) SIGRTMAX-13 52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10
55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6
59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX
</code></pre>
<h2 id="signals-and-process-states"><a class="header" href="#signals-and-process-states">Signals and Process States</a></h2>
<p>Now that you know that it is possible to <strong>interrupt</strong>, <strong>kill</strong> or <strong>stop</strong> processes, it is time for you to learn about processes states.</p>
<p>Processes have many different states, they can be :</p>
<ul>
<li>
<p><strong>Running</strong> : processes running are the ones using some computational power (such as CPU time) in the current time. A process can also be called “runnable” if all running conditions are met, and it is waiting for some CPU time by the CPU scheduler.</p>
</li>
<li>
<p><strong>Stopped</strong> : a signal is stopped is linked to the SIGSTOP signal or to the Ctrl + Z keyboard shortcut. The process execution is suspended and it is either waiting for a SIGCONT or for a SIGKILL.</p>
</li>
<li>
<p><strong>Sleeping</strong> : a sleeping process is a process waiting for some event or for a resource (like a disk) to be available.
Here is a diagram that represents the different process states linked to the signals you may send to them.</p>
</li>
</ul>
<p><strong>Process signal states</strong></p>
<div align="center>
<p><img src="figures/process-states.png" alt="" /></p>
</div>
<p>Now that you know a bit more about process states, let’s have a look at the <code>pgrep</code> and <code>pkill</code> commands.</p>
<h3 id="manipulating-process-with-pgrep-and-pkill"><a class="header" href="#manipulating-process-with-pgrep-and-pkill">Manipulating process with pgrep and pkill</a></h3>
<p>On Linux, there is already a lot that you can do by simply using the <code>ps</code> command.</p>
<p>You can narrow down your search to one particular process, and you can use the <code>PID</code> in order to kill it completely.</p>
<p>However, there are two commands that were designed in order for your commands to be even shorter : <code>pgrep</code> and <code>pkill</code></p>
<h3 id="using-the-pgrep-command"><a class="header" href="#using-the-pgrep-command">Using the <code>pgrep</code> command</a></h3>
<p>The <code>pgrep</code> command is a shortcut for using the <code>ps</code> command piped with the <code>grep</code> command.</p>
<p>The <code>pgrep</code> command will search for all the occurrences for a specific process using a name or a defined pattern.</p>
<p>The syntax of the <code>pgrep</code> command is the following one:</p>
<pre><code class="language-sh">$ pgrep &lt;options&gt; &lt;pattern&gt;
</code></pre>
<p>For example, if you were to search for all processes named &quot;bash&quot; on your host, you would run the following command:</p>
<pre><code class="language-sh">$ pgrep bash
</code></pre>
<p>The <code>pgrep</code> command is not restricted to the processes owned by the current user by default.</p>
<p>If another user was to run the <code>bash</code> command, it would appear in the output of the <code>pgrep</code> command, here I am using <code>zsh</code>, remeber to use <strong>bash</strong>.</p>
<div align="center>
<p><img src="figures/pgrep.png" alt="" /></p>
</div>
<h3 id="using-the-pkill-command"><a class="header" href="#using-the-pkill-command">Using the pkill command</a></h3>
<p>On the other hand, the <code>pkill</code> command is also a shortcut for the <code>ps</code> command used with the <code>kill</code> command.</p>
<p>The <code>pkill</code> command is used in order to send signal to processes based on their IDs or their names.</p>
<p>The syntax of the <code>pkill</code> command is as follows</p>
<pre><code class="language-sh">$ pkill &lt;options&gt; &lt;pattern&gt;
</code></pre>
<p>For example, if you want to kill all Firefox windows on your host, you would run the following command:</p>
<pre><code class="language-sh">$ pkill firefox
</code></pre>
<p>Similarly to the <code>pgrep</code> command, you have the option to narrow down your results by specifying a user with the <code>-u</code> option.</p>
<p>To kill all processes starting with “fire” and owned by the current user and root, you would run the following command</p>
<pre><code class="language-sh">$ pkill user,root fire*
</code></pre>
<p>If you don’t have the rights to stop a process, you will get a permission denied error message to your standard output.</p>
<p>You also have the option to send specific signals by specifying the signal number in the <code>pkill</code> command</p>
<p>For example, in order to stop Firefox with a <strong>SIGSTOP</strong> signal, you would run the following command:</p>
<pre><code class="language-sh">$ pkill -19 firefox
</code></pre>
<hr />
<h2 id="adjusting-process-priority-using-nice-and-renice"><a class="header" href="#adjusting-process-priority-using-nice-and-renice">Adjusting process priority using nice and renice</a></h2>
<p>On Linux, not all processes are given the same priority when it comes to the CPU time.</p>
<p>Some processes, such as very important processes run by <strong>root</strong>, are given a higher priority in order for the operating system to work on tasks that truly matter to the system.</p>
<p>Process priority on Linux is called the <strong>nice</strong> level.</p>
<p>The nice level is a priority scale going from -20 to 19.</p>
<p>The <strong>lower</strong> you go on the niceness scale, the <strong>higher</strong> the priority will be.</p>
<p>Similarly, the <strong>higher</strong> you are on the niceness scale, the <strong>lower</strong> your priority will be.</p>
<p>In order to remember it, you can remember the fact that “the nicer you are, the more you are willing to share resources with others”.</p>
<p><strong>Nicesness Scale</strong></p>
<div align="center>
<p><img src="figures/niceness-scale.png" alt="" /></p>
</div>
<p>In order to start a certain program or process with a given nice level, you will run the following command</p>
<pre><code class="language-sh">$ nice -n &lt;level&gt; &lt;command&gt;
</code></pre>
<p>For example, in order to run the tar command with a custom tar level, you would run the following command</p>
<pre><code class="language-sh">$ nice -n 19 tar -cvf test.tar file
</code></pre>
<p>Similarly, you can use the renice command in order to set the nice level of a running process to a given value.</p>
<pre><code class="language-sh">$ renice -n &lt;priority&gt; &lt;pid&gt;
</code></pre>
<p>For example, if I have a running process with the PID 123, I can use the renice command in order to set its priority to a given value.</p>
<pre><code class="language-sh">$ renice -n 18 123
</code></pre>
<h3 id="niceness-and-permissions"><a class="header" href="#niceness-and-permissions">Niceness and permissions</a></h3>
<p>If you are not a member of the <strong>sudo</strong> group (or a member of the <strong>wheel</strong> group on Red Hat based distributions), there are some restrictions when it comes to what you can with the <code>nice</code> command.</p>
<p>To illustrate it, try to run the following command as a non-sudo user</p>
<pre><code class="language-sh">$ nice -n -1 tar -cvf test.tar file

nice: cannot set niceness: Permission denied

</code></pre>
<p>When it comes to <em>niceness</em>, there is one rule that you need to know :</p>
<p>As a non-root (or sudo) user, you won’t be able to set a nice level lower than the default assigned one (which is zero), and you won’t be able to renice a running process to a lower level than the current one.</p>
<p>To illustrate the last point, launch a sleep command in the background with a nice value of 2.</p>
<pre><code class="language-sh">$ nice -n 2 sleep 10000 &amp;
</code></pre>
<p>Next, identify the process ID of the process you just created:</p>
<pre><code class="language-sh">$ ps aux | grep &quot;sleep 10000&quot;
</code></pre>
<div align="center>
<p><img src="figures/nice-sleep.png" alt="" /></p>
</div>
<p>Now, try to set the nice level of your process to a value lower to the one you specified in the first place.</p>
<pre><code class="language-sh">$ renice -n 1 8363
</code></pre>
<div align="center>
<p><img src="figures/renice-sleep.png" alt="" /></p>
</div>
<p>As you probably noticed, you won’t be able to set the niceness level to 1, but only to a value higher than the one you specified.</p>
<p>Now if you choose to execute the command as sudo, you will be able to set the nice level to a lower value.</p>
<div align="center>
<p><img src="figures/renice-sleep.png" alt="" /></p>
</div>
<p>Now that you have a clear idea of the nice and renice commands, let’s see how you can monitor your processes in real time on Linux.</p>
<div align="center>
<p><img src="figures/sudo-renice-sleep.png" alt="" /></p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Multi-ThreadedScripting-ProcessManagement/Multi-ThreadedScripting-ProcessManagement.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../SystemCalls/SystemCalls.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Multi-ThreadedScripting-ProcessManagement/Multi-ThreadedScripting-ProcessManagement.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../SystemCalls/SystemCalls.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
